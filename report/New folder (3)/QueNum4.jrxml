<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="QueNum" language="groovy" pageWidth="204" pageHeight="566" columnWidth="178" leftMargin="19" rightMargin="7" topMargin="7" bottomMargin="16" isIgnorePagination="true" uuid="11b0103e-1c60-495a-a581-6a7167fe01c3">
    <property name="ireport.zoom" value="3.221020000000027"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    <parameter name="counterlane" class="java.lang.String">
        <defaultValueExpression><![CDATA[ER2]]></defaultValueExpression>
    </parameter>
    <parameter name="usrid" class="java.lang.String">
        <defaultValueExpression><![CDATA[]]></defaultValueExpression>
    </parameter>
    <queryString>
		<![CDATA[SELECT CASE WHEN (u.fcnum + 1) >= u.max1 THEN u.min1 ELSE u.fcnum + 1 END xnum,u.min1, u.max1, u.fttype, u.fcounter, u.fdescrip, u.flane, now() FROM ( SELECT CASE WHEN t.fcnum IS NULL THEN t.fcnumstart - 1 ELSE t.fcnum END fcnum, t.fcnumstart AS 'min1', t.fcnum2 AS 'max1', t.fttype, t.fcounter, t.fdescrip, t.flane FROM ( SELECT y.fcnum, x.fcnum2, x.fttype, x.fcounter, x.fdescrip, x.flane, x.fcnumstart FROM ( SELECT fcnum2, flane fttype, fcounter, fdescrip, flane, fcnum fcnumstart FROM ftable WHERE flane = $P{counterlane} ) x LEFT JOIN ( SELECT d.fcnum fcnum FROM ttable d WHERE d.fcnum >= ( SELECT fcnum FROM ftable WHERE flane = $P{counterlane} ) AND d.fcnum < ( SELECT fcnum2 FROM ftable WHERE flane = $P{counterlane}) AND d.findex = ( SELECT max(findex) FROM ttable e WHERE e.fcnum >= ( SELECT fcnum FROM ftable WHERE flane = $P{counterlane} ) AND e.fcnum < ( SELECT fcnum2 FROM ftable WHERE flane = $P{counterlane} ))) y ON x.flane = $P{counterlane} ) t ) u;]]>
    </queryString>
    <field name="xnum" class="java.lang.String"/>
    <field name="min1" class="java.lang.String"/>
    <field name="max1" class="java.lang.String"/>
    <field name="fttype" class="java.lang.String"/>
    <field name="fcounter" class="java.lang.String">
        <fieldDescription><![CDATA[]]></fieldDescription>
    </field>
    <field name="fdescrip" class="java.lang.String">
        <fieldDescription><![CDATA[]]></fieldDescription>
    </field>
    <field name="flane" class="java.lang.String">
        <fieldDescription><![CDATA[]]></fieldDescription>
    </field>
    <field name="now()" class="java.sql.Timestamp"/>
    <background>
        <band height="543">
            <frame>
                <reportElement x="13" y="0" width="165" height="92" uuid="bfcea7d9-3481-435c-a509-f701b6b60ae2"/>
                <box>
                    <topPen lineWidth="1.75"/>
                    <bottomPen lineWidth="1.75"/>
                </box>
                <image>
                    <reportElement x="28" y="0" width="117" height="41" uuid="e9dd8301-c42e-4cf3-a98f-79211bbae71d"/>
                    <imageExpression><![CDATA["C:\\itmu\\queuenumber\\img\\phic.jpg"]]></imageExpression>
                </image>
            </frame>
            <textField pattern="dd-MM-yyyy h:mm a">
                <reportElement x="61" y="92" width="69" height="7" uuid="ba7063af-f7b9-4e90-a12e-559e7e7efa2b"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="4"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="13" y="99" width="167" height="12" uuid="abb4861e-ae95-45b9-861f-3c9a4facb300"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="4" isBold="true"/>
                </textElement>
                <text><![CDATA[If your Queue Number was called and you're not
around, this Queue Number will be VOID.]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy h.mm a" isBlankWhenNull="false">
                <reportElement mode="Transparent" x="130" y="92" width="47" height="7" forecolor="#000000" backcolor="#FFFFFF" uuid="6d8d3f92-15da-4d74-beaa-dc0ca21a3e9c"/>
                <textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" markup="none">
                    <font fontName="SansSerif" size="4" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{usrid}]]></textFieldExpression>
            </textField>
        </band>
    </background>
    <columnHeader>
        <band height="47">
            <staticText>
                <reportElement x="0" y="32" width="177" height="8" uuid="5c5b26db-f89d-4081-aee1-d15ec08acd0f"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="SansSerif" size="6" isBold="false" isItalic="false"/>
                </textElement>
                <text><![CDATA[Your Counter Number is]]></text>
            </staticText>
        </band>
    </columnHeader>
    <detail>
        <band height="56">
            <textField>
                <reportElement x="0" y="29" width="177" height="11" uuid="58a56da7-7121-4c6c-a13c-363936110530"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="8" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{fdescrip}]]></textFieldExpression>
            </textField>
            <textField pattern="" isBlankWhenNull="false">
                <reportElement stretchType="RelativeToBandHeight" mode="Transparent" x="0" y="-17" width="177" height="47" forecolor="#000000" backcolor="#FFFFFF" uuid="68dba684-1c4d-4967-82b5-10d6f89e2f13"/>
                <textElement textAlignment="Center" verticalAlignment="Bottom" rotation="None" markup="none">
                    <font fontName="Tahoma" size="36" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                    <paragraph lineSpacing="Single"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{xnum}]]></textFieldExpression>
            </textField>
        </band>
    </detail>
</jasperReport>
